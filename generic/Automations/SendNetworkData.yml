commonfields:
  id: 99efb7ff-6531-4022-84ab-27c1aeaab092
  version: 23
name: SendNetworkData
script: |-
  ########################################################################
  # This script will take a data "blob" and send it using Pythong sockets
  ########################################################################

  import socket


  dest = demisto.args()["host"]
  port = int(demisto.args()["port"])
  data = demisto.args()["data"]
  if demisto.args()["protocol"].lower() == "tcp":
      protocol = socket.SOCK_STREAM
  if demisto.args()["protocol"].lower() == "udp":
      protocol = socket.SOCK_DGRAM
  if not is_ip_valid(dest):
      try:
          dest = socket.gethostbyname(dest)
      except socket.error as err:
          demisto.error("Error resolving {0} to an IP address - {1}".format(dest, err))
          demisto.results("Error resolving {0} to an IP address - {1}".format(dest, err))
          exit(-1)


  # Try and setup the socket
  try:
      s = socket.socket(socket.AF_INET, protocol)
      demisto.debug("Socket creation successful")
  except Exception as err:
      demisto.error("Socket creation failed")
      demisto.results("Socket creation failed")
      exit(-1)

  # Try and connect to the destination
  try:
      s.connect((dest,port))
  except socket.error as err:
      demisto.error("Could not connect to {0}:{1} - {2}".format(dest,port,err))
      demisto.results("Could not connect to {0}:{1} - {2}".format(dest,port,err))
      exit(-1)

  # Try and send the data
  try:
      result = s.send(data)
      demisto.results("Sent {0} bytes to {1}:{2}".format(result, dest, port))
      demisto.debug("Sent {0} bytes to {1}:{2}".format(result, dest, port))
  except socket.error as err:
      demisto.error("Could not send data to {0}:{1} - {2}".format(dest,port,err))
  exit(0)
type: python
tags: []
comment: Attempts to send data using Pythong socket library
enabled: true
args:
- name: host
  required: true
  description: Host name or IP to send data to
- name: port
  required: true
  description: Port number
- name: protocol
  required: true
  auto: PREDEFINED
  predefined:
  - TCP
  - UDP
  defaultValue: TCP
- name: data
  required: true
  description: The data to send via syslog
scripttarget: 0
runonce: false
runas: DBotWeakRole
